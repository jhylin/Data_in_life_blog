<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jennifer HY Lin">
<meta name="dcterms.date" content="2024-01-17">

<title>Random forest classifier – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bdd2aebeb936dcddaa5f935a5de481c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ccd81253fefb92e9cd3f9eb5b5d87b54.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-6bdd2aebeb936dcddaa5f935a5de481c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5CHVP3K63C"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5CHVP3K63C', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../past_projects.html"> 
<span class="menu-text">Past projects</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jhylin"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jenhylin"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jhylin.github.io/CV_resume_quarto/"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Random forest classifier</h1>
            <p class="subtitle lead">Series 2.2.1 - more on imbalanced dataset</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Machine learning projects</div>
                <div class="quarto-category">Tree models</div>
                <div class="quarto-category">Pandas</div>
                <div class="quarto-category">Scikit-learn</div>
                <div class="quarto-category">RDKit</div>
                <div class="quarto-category">ChEMBL database</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jennifer HY Lin </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 17, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#brief-introduction" id="toc-brief-introduction" class="nav-link active" data-scroll-target="#brief-introduction"><strong>Brief introduction</strong></a></li>
  <li><a href="#overview-of-post" id="toc-overview-of-post" class="nav-link" data-scroll-target="#overview-of-post"><strong>Overview of post</strong></a></li>
  <li><a href="#importing-libraries" id="toc-importing-libraries" class="nav-link" data-scroll-target="#importing-libraries"><strong>Importing libraries</strong></a></li>
  <li><a href="#data-retrieval-using-chembl_downloader" id="toc-data-retrieval-using-chembl_downloader" class="nav-link" data-scroll-target="#data-retrieval-using-chembl_downloader"><strong>Data retrieval using chembl_downloader</strong></a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jhylin/Data_in_life_blog/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p><em>The section on “Data retrieval using chembl_downloader” has been updated and finalised on 31st January 2024 - many thanks for the comment from Charles Tapley Hoyt (cthoyt)</em>.</p>
<p><em>Jupyter notebook version can be accessed <a href="https://github.com/jhylin/ML2-2_random_forest/blob/main/2_random_forest_classifier.ipynb">here</a></em>.</p>
<p><br></p>
<section id="brief-introduction" class="level5">
<h5 class="anchored" data-anchor-id="brief-introduction"><strong>Brief introduction</strong></h5>
<p>This post was really just an addition towards the last random forest (RF) post. It was mainly inspired by this paper <span class="citation" data-cites="esposito2021">(<a href="#ref-esposito2021" role="doc-biblioref">Esposito et al. 2021</a>)</span> from <a href="https://github.com/rinikerlab">rinikerlab</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. It was nice to complete the RF series by adding a RF classifier since last post was only on a regressor. Another thing was that imbalanced datasets were common in drug discovery projects, learning different strategies to deal with them was also very useful. While working on this post, I also came across a few other packages that I haven’t used before so I’ve included them all down below.</p>
<p><br></p>
</section>
<section id="overview-of-post" class="level5">
<h5 class="anchored" data-anchor-id="overview-of-post"><strong>Overview of post</strong></h5>
<ul>
<li>Data sourcing via <em>chembl_downloader</em></li>
<li>Minor data preprocessing using own little script and also SMILES checker from <em>scikit_mol</em></li>
<li><em>scikit-learn</em>’s RandomForestClassifier()</li>
<li>Dealing with imbalanced dataset in RF classifiers by using <em>ghostml</em></li>
<li>A small section on plotting receiver operating characteristic (ROC) curves</li>
</ul>
<p><br></p>
</section>
<section id="importing-libraries" class="level5">
<h5 class="anchored" data-anchor-id="importing-libraries"><strong>Importing libraries</strong></h5>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chembl_downloader</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chembl_downloader <span class="im">import</span> latest, queries, query</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Descriptors</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datamol <span class="im">as</span> dm</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> ConfusionMatrixDisplay</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> RocCurveDisplay, roc_curve</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scikit_mol.utilities <span class="im">import</span> CheckSmilesSanitazion</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ghostml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="data-retrieval-using-chembl_downloader" class="level5">
<h5 class="anchored" data-anchor-id="data-retrieval-using-chembl_downloader"><strong>Data retrieval using chembl_downloader</strong></h5>
<p>chembl_downloader was something I wanted to try a while back. I’ve tried manual download and chembl_webresource_client previously, and they were probably not the best strategies for data reproducibility. The idea of chembl_downloader was to generate a reproducible ChEMBL data source. It involved some SQL at the beginning to specify the exact type of data needed, so some SQL knowledge were required. Other uses for this package were elaborated much more clearly in its GitHub repository at <a href="https://github.com/cthoyt/chembl-downloader">https://github.com/cthoyt/chembl-downloader</a>. One of the reference notebooks that I’ve used could be reached <a href="https://github.com/cthoyt/chembl-downloader/blob/main/notebooks/drug-indications.ipynb">here</a> (more available in its repository).</p>
<p>What I did was shown below.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the latest version of ChEMBL used</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>latest_version <span class="op">=</span> latest()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The latest ChEMBL version is: </span><span class="sc">{</span>latest_version<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The latest ChEMBL version is: 33</code></pre>
</div>
</div>
<p>The following section was updated as suggested by cthoyt (via his comment for post below). I ended up putting through my first ever pull request in an open-source and cheminformatics-related repository. A new option to choose max_phase was added into the get_target_sql function in chembl_downloader by keeping it as a togglable option via boolean flag. Many thanks for the patience from cthoyt for guiding me through it. The overall code was now changed as shown below.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate SQL for a query on acetylcholinesterase (AChE): CHEMBL220</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> queries.get_target_sql(target_id<span class="op">=</span><span class="st">"CHEMBL220"</span>, target_type<span class="op">=</span><span class="st">"SINGLE PROTEIN"</span>, max_phase<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty-print the SQL in Jupyter</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>queries.markdown(sql)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    ASSAYS.chembl_id              <span class="kw">AS</span> assay_chembl_id,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    TARGET_DICTIONARY.target_type,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    TARGET_DICTIONARY.tax_id,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    COMPOUND_STRUCTURES.canonical_smiles,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    MOLECULE_DICTIONARY.chembl_id <span class="kw">AS</span> molecule_chembl_id,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    MOLECULE_DICTIONARY.max_phase,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    ACTIVITIES.standard_type,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    ACTIVITIES.pchembl_value</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> TARGET_DICTIONARY</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">JOIN</span> ASSAYS <span class="kw">ON</span> TARGET_DICTIONARY.tid <span class="op">==</span> ASSAYS.tid</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">JOIN</span> ACTIVITIES <span class="kw">ON</span> ASSAYS.assay_id <span class="op">==</span> ACTIVITIES.assay_id</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>     <span class="kw">JOIN</span> MOLECULE_DICTIONARY <span class="kw">ON</span> MOLECULE_DICTIONARY.molregno <span class="op">==</span> ACTIVITIES.molregno</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>     <span class="kw">JOIN</span> COMPOUND_STRUCTURES <span class="kw">ON</span> MOLECULE_DICTIONARY.molregno <span class="op">==</span> COMPOUND_STRUCTURES.molregno</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> TARGET_DICTIONARY.chembl_id <span class="op">=</span> <span class="st">'CHEMBL220'</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> ACTIVITIES.pchembl_value <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> TARGET_DICTIONARY.target_type <span class="op">=</span> <span class="st">'SINGLE PROTEIN'</span>```</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>::: {.cell execution_count<span class="op">=</span><span class="dv">4</span>}</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>``` {.python .cell<span class="op">-</span>code}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a># <span class="kw">The</span> SQL still works <span class="kw">as</span> shown above, </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a># please ignore <span class="kw">the</span> non<span class="op">-</span>SQL texts</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a># <span class="op">-</span> bit <span class="kw">of</span> a formatting issue </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a># <span class="cf">when</span> pretty<span class="op">-</span>printing <span class="kw">the</span> sql, </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a># but shouldn<span class="st">'t affect the code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ve also updated how I retrieved and saved the ChEMBL data with the following code suggested and provided by cthoyt. This would be a better and more reproducible way for anyone who might be interested in re-running this notebook.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick any directory, but make sure it's relative to your home directory</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> Path.home().joinpath(<span class="st">".data"</span>, <span class="st">"blog"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the directory if it doesn't exist</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>directory.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>, parents<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a file path that corresponds to the version, since this could change</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> directory.joinpath(<span class="ss">f"chembl_d_ache_</span><span class="sc">{</span>latest_version<span class="sc">}</span><span class="ss">.tsv"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path.is_file():</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the file already exists, load it</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    df_ache <span class="op">=</span> pd.read_csv(path, sep<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the file doesn't already exist, make the query then cache it</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    df_ache <span class="op">=</span> chembl_downloader.query(sql)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    df_ache.to_csv(path, sep<span class="op">=</span><span class="st">","</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The rest of the code outputs in the post stayed the same as before. The only thing changed and updated was the part on retrieving ChEMBL data via chembl_downloader.</p>
<p><br></p>
<section id="some-data-cleaning" class="level5">
<h5 class="anchored" data-anchor-id="some-data-cleaning"><strong>Some data cleaning</strong></h5>
<p>Minor cleaning and preprocessing were done for this post only, as the focus was more on dealing with imbalanced dataset in RF classifier. Since I used a different way to retrieve ChEMBL data this time, the dataset used here might be slightly different from the one used in previous post.</p>
<p><br></p>
<section id="mol_prep.py" class="level6">
<h6 class="anchored" data-anchor-id="mol_prep.py"><strong>mol_prep.py</strong></h6>
<p>I’ve more or less accumulated small pieces of code over time, and I’ve decided to compile them into a Python script. The idea was to remove most function code in the post to avoid repeating them all the time since they’ve been used frequently in the last few posts. The script would be saved into the <a href="https://github.com/jhylin/ML2-2_random_forest">RF repository</a>, and would still be considered as a “work-in-progress” script (needs more work in the future).</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Trial own mol_prep.py script</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mol_prep <span class="im">import</span> preprocess, rdkit_2d_descriptors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Preprocess/standardise molecules</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Running preprocess function </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_ache <span class="op">=</span> df_ache.copy()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df_prep <span class="op">=</span> df_ache.<span class="bu">apply</span>(preprocess, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df_prep.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">assay_chembl_id</th>
<th data-quarto-table-cell-role="th">target_type</th>
<th data-quarto-table-cell-role="th">tax_id</th>
<th data-quarto-table-cell-role="th">chembl_id</th>
<th data-quarto-table-cell-role="th">canonical_smiles</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">standard_type</th>
<th data-quarto-table-cell-role="th">pchembl_value</th>
<th data-quarto-table-cell-role="th">rdkit_mol</th>
<th data-quarto-table-cell-role="th">standard_smiles</th>
<th data-quarto-table-cell-role="th">selfies</th>
<th data-quarto-table-cell-role="th">inchi</th>
<th data-quarto-table-cell-role="th">inchikey</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CHEMBL1909212</td>
<td>SINGLE PROTEIN</td>
<td>9606</td>
<td>CHEMBL220</td>
<td>CC/C(=C(/CC)c1ccc(O)cc1)c1ccc(O)cc1</td>
<td>CHEMBL411</td>
<td>4.0</td>
<td>IC50</td>
<td>4.59</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x12b7f2180&gt;</td>
<td>CC/C(=C(/CC)c1ccc(O)cc1)c1ccc(O)cc1</td>
<td>[C][C][/C][=Branch1][P][=C][Branch1][Ring1][/C...</td>
<td>InChI=1S/C18H20O2/c1-3-17(13-5-9-15(19)10-6-13...</td>
<td>RGLYKWWBQGJZGM-ISLYRVAYSA-N</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CHEMBL1003053</td>
<td>SINGLE PROTEIN</td>
<td>9606</td>
<td>CHEMBL220</td>
<td>COc1c2occc2cc2ccc(=O)oc12</td>
<td>CHEMBL416</td>
<td>4.0</td>
<td>IC50</td>
<td>4.27</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x12b7f22d0&gt;</td>
<td>COc1c2occc2cc2ccc(=O)oc12</td>
<td>[C][O][C][=C][O][C][=C][C][Ring1][Branch1][=C]...</td>
<td>InChI=1S/C12H8O4/c1-14-12-10-8(4-5-15-10)6-7-2...</td>
<td>QXKHYNVANLEOEG-UHFFFAOYSA-N</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CHEMBL2406149</td>
<td>SINGLE PROTEIN</td>
<td>9606</td>
<td>CHEMBL220</td>
<td>COc1c2occc2cc2ccc(=O)oc12</td>
<td>CHEMBL416</td>
<td>4.0</td>
<td>IC50</td>
<td>6.12</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x12b7f2340&gt;</td>
<td>COc1c2occc2cc2ccc(=O)oc12</td>
<td>[C][O][C][=C][O][C][=C][C][Ring1][Branch1][=C]...</td>
<td>InChI=1S/C12H8O4/c1-14-12-10-8(4-5-15-10)6-7-2...</td>
<td>QXKHYNVANLEOEG-UHFFFAOYSA-N</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="scikit_mol" class="level6">
<h6 class="anchored" data-anchor-id="scikit_mol"><strong>scikit_mol</strong></h6>
<p>scikit_mol was a package originated from RDKit UGM hackathon in 2022. This <a href="https://www.cheminformania.com/scikit-mol-easy-embedding-of-rdkit-into-scikit-learn/">blog post</a> elaborated further on its functions and uses in machine learning. For this post I’ve only used it for a very small portion, mainly to check for missing SMILES or errors in SMILES (kind of like double checking whether the preprocess function code worked as expected). It could be integrated with <em>scikit-learn</em>’s pipeline method for multiple estimators. Its GitHub Repository link: <a href="https://github.com/EBjerrum/scikit-mol">https://github.com/EBjerrum/scikit-mol</a> - I’ve referred to this <a href="https://github.com/EBjerrum/scikit-mol/blob/main/notebooks/05_smiles_sanitaztion.ipynb">reference notebook</a> while working on this post.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick simple way to check for missing SMILES</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Dataset contains </span><span class="sc">{</span>df_prep<span class="sc">.</span>standard_smiles<span class="sc">.</span>isna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> unparsable mols'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset contains 0 unparsable mols</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for invalid SMILES using scikit_mol</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>smileschecker <span class="op">=</span> CheckSmilesSanitazion()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>smileschecker.sanitize(<span class="bu">list</span>(df_prep.standard_smiles))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Showing SMILES errors</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>smileschecker.errors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SMILES</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>It showed no errors in SMILES (errors should be listed in the code cell output).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Generate RDKit 2D descriptors/fingerprints</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Running rdkit_2d_descriptors function</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_2d <span class="op">=</span> rdkit_2d_descriptors(df_prep)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df_2d.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">ExactMolWt</th>
<th data-quarto-table-cell-role="th">NumValenceElectrons</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9.41068</td>
<td>9.41068</td>
<td>0.284153</td>
<td>0.284153</td>
<td>0.779698</td>
<td>12.1000</td>
<td>268.356</td>
<td>248.196</td>
<td>268.146330</td>
<td>104</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>11.17310</td>
<td>11.17310</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.0625</td>
<td>216.192</td>
<td>208.128</td>
<td>216.042259</td>
<td>80</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11.17310</td>
<td>11.17310</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.0625</td>
<td>216.192</td>
<td>208.128</td>
<td>216.042259</td>
<td>80</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>3 rows × 210 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge dataframes df_prep &amp; df_2d via index</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_merge <span class="op">=</span> pd.merge(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    df_prep[[<span class="st">"max_phase"</span>, <span class="st">"molecule_chembl_id"</span>]],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    df_2d,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    left_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    right_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_merge.shape)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>df_merge.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(7144, 212)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4.0</td>
<td>CHEMBL411</td>
<td>9.41068</td>
<td>9.41068</td>
<td>0.284153</td>
<td>0.284153</td>
<td>0.779698</td>
<td>12.1000</td>
<td>268.356</td>
<td>248.196</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>CHEMBL416</td>
<td>11.17310</td>
<td>11.17310</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.0625</td>
<td>216.192</td>
<td>208.128</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.0</td>
<td>CHEMBL416</td>
<td>11.17310</td>
<td>11.17310</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.0625</td>
<td>216.192</td>
<td>208.128</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>3 rows × 212 columns</p>
</div>
</div>
</div>
<p>A different spreads of max phases were shown this time in the dataframe, as the SQL query mainly used IC50, whereas last post was strictly limited to Ki via ChEMBL web resource client. Other likely reason was that in the decision tree series, I’ve attempted data preprocessing at a larger scale so some data were eliminated. It appeared that there were more max phase 4 compounds here than last time (note: null compounds were not shown in the value counts as it was labelled as “NaN”, it should be the largest max phase portion in the data).</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find out counts of each max phase</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_merge.value_counts(<span class="st">"max_phase"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>max_phase
 4.0    618
-1.0     69
 2.0     29
 3.0     10
 1.0      7
 0.5      1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>I then tried searching for the chembl_id of the 10 max phase 4 compounds used in the last post in the dataframe (df_merge).</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Previously used 10 max phase 4 compounds</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># donepezil = CHEMBL502 &amp; galantamine = CHEMBL659</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>list_mp4 <span class="op">=</span> [<span class="st">"CHEMBL95"</span>, <span class="st">"CHEMBL1128"</span>, <span class="st">"CHEMBL640"</span>, <span class="st">"CHEMBL502"</span>, <span class="st">"CHEMBL481"</span>, <span class="st">"CHEMBL360055"</span>, <span class="st">"CHEMBL1025"</span>, <span class="st">"CHEMBL659"</span>, <span class="st">"CHEMBL1200970"</span>, <span class="st">"CHEMBL1677"</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for compounds in list_mp4 within df_merge's "molecule_chembl_id" column</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># using Series.isin</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>df_prev <span class="op">=</span> df_merge.loc[df_merge[<span class="st">"molecule_chembl_id"</span>].isin(list_mp4)]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>df_prev.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>4.0</td>
<td>CHEMBL481</td>
<td>13.581173</td>
<td>13.581173</td>
<td>0.095133</td>
<td>-1.863974</td>
<td>0.355956</td>
<td>22.209302</td>
<td>586.689</td>
<td>548.385</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>4.0</td>
<td>CHEMBL481</td>
<td>13.581173</td>
<td>13.581173</td>
<td>0.095133</td>
<td>-1.863974</td>
<td>0.355956</td>
<td>22.209302</td>
<td>586.689</td>
<td>548.385</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">67</td>
<td>4.0</td>
<td>CHEMBL95</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.953981</td>
<td>0.953981</td>
<td>0.706488</td>
<td>15.200000</td>
<td>198.269</td>
<td>184.157</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68</td>
<td>4.0</td>
<td>CHEMBL95</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.953981</td>
<td>0.953981</td>
<td>0.706488</td>
<td>15.200000</td>
<td>198.269</td>
<td>184.157</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">69</td>
<td>4.0</td>
<td>CHEMBL95</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.953981</td>
<td>0.953981</td>
<td>0.706488</td>
<td>15.200000</td>
<td>198.269</td>
<td>184.157</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 212 columns</p>
</div>
</div>
</div>
<p>There were many duplicates of compounds.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_prev.shape)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_prev.value_counts(<span class="st">"molecule_chembl_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(439, 212)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>molecule_chembl_id
CHEMBL95         182
CHEMBL502        143
CHEMBL659         76
CHEMBL1128        12
CHEMBL1677        10
CHEMBL1200970      6
CHEMBL640          4
CHEMBL1025         3
CHEMBL481          2
CHEMBL360055       1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping duplicated compound via chembl IDs in the main df</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_merge_new <span class="op">=</span> df_merge.drop_duplicates(subset<span class="op">=</span>[<span class="st">"molecule_chembl_id"</span>], keep<span class="op">=</span><span class="st">"first"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_merge_new.shape)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df_merge_new.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5357, 212)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4.0</td>
<td>CHEMBL411</td>
<td>9.410680</td>
<td>9.410680</td>
<td>0.284153</td>
<td>0.284153</td>
<td>0.779698</td>
<td>12.100000</td>
<td>268.356</td>
<td>248.196</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>CHEMBL416</td>
<td>11.173100</td>
<td>11.173100</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.062500</td>
<td>216.192</td>
<td>208.128</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>-1.0</td>
<td>CHEMBL7002</td>
<td>11.591481</td>
<td>11.591481</td>
<td>0.189306</td>
<td>-0.309798</td>
<td>0.886859</td>
<td>23.608696</td>
<td>333.453</td>
<td>310.269</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>CHEMBL28</td>
<td>12.020910</td>
<td>12.020910</td>
<td>0.018823</td>
<td>-0.410347</td>
<td>0.631833</td>
<td>10.800000</td>
<td>270.240</td>
<td>260.160</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>4.0</td>
<td>CHEMBL41</td>
<td>12.564531</td>
<td>12.564531</td>
<td>0.203346</td>
<td>-4.329869</td>
<td>0.851796</td>
<td>12.909091</td>
<td>309.331</td>
<td>291.187</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 212 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Making sure previously used 10 max phase 4 compounds could be found in df_merge_new</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_mp4 <span class="op">=</span> df_merge_new.loc[df_merge_new[<span class="st">"molecule_chembl_id"</span>].isin(list_mp4)]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_mp4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>4.0</td>
<td>CHEMBL481</td>
<td>13.581173</td>
<td>13.581173</td>
<td>0.095133</td>
<td>-1.863974</td>
<td>0.355956</td>
<td>22.209302</td>
<td>586.689</td>
<td>548.385</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>4.0</td>
<td>CHEMBL95</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.953981</td>
<td>0.953981</td>
<td>0.706488</td>
<td>15.200000</td>
<td>198.269</td>
<td>184.157</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>4.0</td>
<td>CHEMBL502</td>
<td>12.936933</td>
<td>12.936933</td>
<td>0.108783</td>
<td>0.108783</td>
<td>0.747461</td>
<td>20.214286</td>
<td>379.500</td>
<td>350.268</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">508</td>
<td>4.0</td>
<td>CHEMBL640</td>
<td>11.743677</td>
<td>11.743677</td>
<td>0.044300</td>
<td>-0.044300</td>
<td>0.731540</td>
<td>10.529412</td>
<td>235.331</td>
<td>214.163</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">512</td>
<td>4.0</td>
<td>CHEMBL659</td>
<td>9.972866</td>
<td>9.972866</td>
<td>0.008380</td>
<td>-0.411699</td>
<td>0.800524</td>
<td>33.857143</td>
<td>287.359</td>
<td>266.191</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1013</td>
<td>4.0</td>
<td>CHEMBL1025</td>
<td>12.703056</td>
<td>12.703056</td>
<td>0.426312</td>
<td>-4.304784</td>
<td>0.629869</td>
<td>13.000000</td>
<td>184.147</td>
<td>170.035</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1345</td>
<td>4.0</td>
<td>CHEMBL1128</td>
<td>9.261910</td>
<td>9.261910</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.608112</td>
<td>10.692308</td>
<td>201.697</td>
<td>185.569</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2028</td>
<td>4.0</td>
<td>CHEMBL360055</td>
<td>6.476818</td>
<td>6.476818</td>
<td>0.656759</td>
<td>0.656759</td>
<td>0.205822</td>
<td>12.583333</td>
<td>510.828</td>
<td>450.348</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2725</td>
<td>4.0</td>
<td>CHEMBL1677</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.760853</td>
<td>14.250000</td>
<td>234.730</td>
<td>219.610</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3271</td>
<td>4.0</td>
<td>CHEMBL1200970</td>
<td>2.520809</td>
<td>2.520809</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.709785</td>
<td>14.000000</td>
<td>348.943</td>
<td>323.743</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>10 rows × 212 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note: compounds with max phase 0 not shown in the count</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df_merge_new.value_counts(<span class="st">"max_phase"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>max_phase
 4.0    55
-1.0    26
 2.0     8
 3.0     7
 1.0     4
 0.5     1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="model-building" class="level5">
<h5 class="anchored" data-anchor-id="model-building"><strong>Model building</strong></h5>
<p>The aim of this post was to model and classify the max phases of ChEMBL small molecules, i.e.&nbsp;whether the compounds in the testing set (consisted of max phase 0 or null compounds) might be eventually classified as max phase 4 or not. This was one of the approaches to answer the question in mind, and not the ultimate way to solve the problem (just thought to mention). The target was “max_phase” and features to be used were the various RDKit 2D descriptors (RDKit2D).</p>
<p>The steps I’ve taken to build the model were shown below:</p>
<ol type="1">
<li>Re-labelled max phases as binary labels (e.g.&nbsp;max phase null as 0, max phase 4 as 1)</li>
</ol>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-label max phase NaN as 0</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_merge_new <span class="op">=</span> df_merge_new.fillna(<span class="dv">0</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df_merge_new.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4.0</td>
<td>CHEMBL411</td>
<td>9.410680</td>
<td>9.410680</td>
<td>0.284153</td>
<td>0.284153</td>
<td>0.779698</td>
<td>12.100000</td>
<td>268.356</td>
<td>248.196</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>CHEMBL416</td>
<td>11.173100</td>
<td>11.173100</td>
<td>0.405828</td>
<td>-0.405828</td>
<td>0.586359</td>
<td>11.062500</td>
<td>216.192</td>
<td>208.128</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>-1.0</td>
<td>CHEMBL7002</td>
<td>11.591481</td>
<td>11.591481</td>
<td>0.189306</td>
<td>-0.309798</td>
<td>0.886859</td>
<td>23.608696</td>
<td>333.453</td>
<td>310.269</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>CHEMBL28</td>
<td>12.020910</td>
<td>12.020910</td>
<td>0.018823</td>
<td>-0.410347</td>
<td>0.631833</td>
<td>10.800000</td>
<td>270.240</td>
<td>260.160</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>4.0</td>
<td>CHEMBL41</td>
<td>12.564531</td>
<td>12.564531</td>
<td>0.203346</td>
<td>-4.329869</td>
<td>0.851796</td>
<td>12.909091</td>
<td>309.331</td>
<td>291.187</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 212 columns</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Splitted data into max phase null &amp; max phase 4 (needing to re-label max phase 4 column only as 1, and not disrupting the labels of max phase 0 compounds)</li>
</ol>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all max phase null compounds</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_null <span class="op">=</span> df_merge_new[df_merge_new[<span class="st">"max_phase"</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_null.shape)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>df_null.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5256, 212)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">HeavyAtomMolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>CHEMBL28</td>
<td>12.020910</td>
<td>12.020910</td>
<td>0.018823</td>
<td>-0.410347</td>
<td>0.631833</td>
<td>10.800000</td>
<td>270.240</td>
<td>260.160</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.0</td>
<td>CHEMBL8320</td>
<td>10.282778</td>
<td>10.282778</td>
<td>0.120741</td>
<td>-0.120741</td>
<td>0.416681</td>
<td>17.500000</td>
<td>108.096</td>
<td>104.064</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.0</td>
<td>CHEMBL11833</td>
<td>11.201531</td>
<td>11.201531</td>
<td>0.428520</td>
<td>-0.466092</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>244.165</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">392</td>
<td>0.0</td>
<td>CHEMBL12324</td>
<td>11.257704</td>
<td>11.257704</td>
<td>0.462395</td>
<td>-0.462395</td>
<td>0.797990</td>
<td>26.150000</td>
<td>277.344</td>
<td>256.176</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">393</td>
<td>0.0</td>
<td>CHEMBL274107</td>
<td>11.359778</td>
<td>11.359778</td>
<td>0.372211</td>
<td>-0.473241</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>244.165</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 212 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using pd.DataFrame.assign to add a new column to re-label max_phase 4 as "1"</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df_mp4_lb <span class="op">=</span> df_mp4.assign(max_phase_lb <span class="op">=</span> df_mp4[<span class="st">"max_phase"</span>] <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Using pd.DataFrame.pop() &amp; insert() to shift added column to first column position</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>first_col <span class="op">=</span> df_mp4_lb.pop(<span class="st">"max_phase_lb"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>df_mp4_lb.insert(<span class="dv">0</span>, <span class="st">"max_phase_lb"</span>, first_col)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>df_mp4_lb.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase_lb</th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL481</td>
<td>13.581173</td>
<td>13.581173</td>
<td>0.095133</td>
<td>-1.863974</td>
<td>0.355956</td>
<td>22.209302</td>
<td>586.689</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL95</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.953981</td>
<td>0.953981</td>
<td>0.706488</td>
<td>15.200000</td>
<td>198.269</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL502</td>
<td>12.936933</td>
<td>12.936933</td>
<td>0.108783</td>
<td>0.108783</td>
<td>0.747461</td>
<td>20.214286</td>
<td>379.500</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">508</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL640</td>
<td>11.743677</td>
<td>11.743677</td>
<td>0.044300</td>
<td>-0.044300</td>
<td>0.731540</td>
<td>10.529412</td>
<td>235.331</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">512</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL659</td>
<td>9.972866</td>
<td>9.972866</td>
<td>0.008380</td>
<td>-0.411699</td>
<td>0.800524</td>
<td>33.857143</td>
<td>287.359</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 213 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Also create a new column max_phase_lb column for df_null </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in order to merge 2 dfs later</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>df_null_lb <span class="op">=</span> df_null.assign(max_phase_lb <span class="op">=</span> df_null[<span class="st">"max_phase"</span>])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>first_col_null <span class="op">=</span> df_null_lb.pop(<span class="st">"max_phase_lb"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>df_null_lb.insert(<span class="dv">0</span>, <span class="st">"max_phase_lb"</span>, first_col_null)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>df_null_lb.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase_lb</th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL28</td>
<td>12.020910</td>
<td>12.020910</td>
<td>0.018823</td>
<td>-0.410347</td>
<td>0.631833</td>
<td>10.800000</td>
<td>270.240</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL8320</td>
<td>10.282778</td>
<td>10.282778</td>
<td>0.120741</td>
<td>-0.120741</td>
<td>0.416681</td>
<td>17.500000</td>
<td>108.096</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL11833</td>
<td>11.201531</td>
<td>11.201531</td>
<td>0.428520</td>
<td>-0.466092</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">392</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL12324</td>
<td>11.257704</td>
<td>11.257704</td>
<td>0.462395</td>
<td>-0.462395</td>
<td>0.797990</td>
<td>26.150000</td>
<td>277.344</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">393</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL274107</td>
<td>11.359778</td>
<td>11.359778</td>
<td>0.372211</td>
<td>-0.473241</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 213 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate df_mp4_lb &amp; df_null_lb</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_full <span class="op">=</span> pd.concat([df_null_lb, df_mp4_lb])</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>df_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">max_phase_lb</th>
<th data-quarto-table-cell-role="th">max_phase</th>
<th data-quarto-table-cell-role="th">molecule_chembl_id</th>
<th data-quarto-table-cell-role="th">MaxAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MaxEStateIndex</th>
<th data-quarto-table-cell-role="th">MinAbsEStateIndex</th>
<th data-quarto-table-cell-role="th">MinEStateIndex</th>
<th data-quarto-table-cell-role="th">qed</th>
<th data-quarto-table-cell-role="th">SPS</th>
<th data-quarto-table-cell-role="th">MolWt</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fr_sulfide</th>
<th data-quarto-table-cell-role="th">fr_sulfonamd</th>
<th data-quarto-table-cell-role="th">fr_sulfone</th>
<th data-quarto-table-cell-role="th">fr_term_acetylene</th>
<th data-quarto-table-cell-role="th">fr_tetrazole</th>
<th data-quarto-table-cell-role="th">fr_thiazole</th>
<th data-quarto-table-cell-role="th">fr_thiocyan</th>
<th data-quarto-table-cell-role="th">fr_thiophene</th>
<th data-quarto-table-cell-role="th">fr_unbrch_alkane</th>
<th data-quarto-table-cell-role="th">fr_urea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL28</td>
<td>12.020910</td>
<td>12.020910</td>
<td>0.018823</td>
<td>-0.410347</td>
<td>0.631833</td>
<td>10.800000</td>
<td>270.240</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL8320</td>
<td>10.282778</td>
<td>10.282778</td>
<td>0.120741</td>
<td>-0.120741</td>
<td>0.416681</td>
<td>17.500000</td>
<td>108.096</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL11833</td>
<td>11.201531</td>
<td>11.201531</td>
<td>0.428520</td>
<td>-0.466092</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">392</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL12324</td>
<td>11.257704</td>
<td>11.257704</td>
<td>0.462395</td>
<td>-0.462395</td>
<td>0.797990</td>
<td>26.150000</td>
<td>277.344</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">393</td>
<td>0.0</td>
<td>0.0</td>
<td>CHEMBL274107</td>
<td>11.359778</td>
<td>11.359778</td>
<td>0.372211</td>
<td>-0.473241</td>
<td>0.838024</td>
<td>25.157895</td>
<td>262.309</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1013</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL1025</td>
<td>12.703056</td>
<td>12.703056</td>
<td>0.426312</td>
<td>-4.304784</td>
<td>0.629869</td>
<td>13.000000</td>
<td>184.147</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1345</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL1128</td>
<td>9.261910</td>
<td>9.261910</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.608112</td>
<td>10.692308</td>
<td>201.697</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2028</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL360055</td>
<td>6.476818</td>
<td>6.476818</td>
<td>0.656759</td>
<td>0.656759</td>
<td>0.205822</td>
<td>12.583333</td>
<td>510.828</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2725</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL1677</td>
<td>6.199769</td>
<td>6.199769</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.760853</td>
<td>14.250000</td>
<td>234.730</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3271</td>
<td>1.0</td>
<td>4.0</td>
<td>CHEMBL1200970</td>
<td>2.520809</td>
<td>2.520809</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.709785</td>
<td>14.000000</td>
<td>348.943</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5266 rows × 213 columns</p>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Defined X and y variables and trained RF classifier model</li>
</ol>
<p>Eventually df_full contained 10 active compounds and 5256 inactive compounds (from the value counts).</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_full.value_counts(<span class="st">"max_phase_lb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>max_phase_lb
0.0    5256
1.0      10
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining X (features) &amp; y (target)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_full.iloc[:, <span class="dv">3</span>:]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_full.iloc[:, <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking right data were selected e.g. y as target</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>4       0.0
8       0.0
14      0.0
392     0.0
393     0.0
       ... 
1013    1.0
1345    1.0
2028    1.0
2725    1.0
3271    1.0
Name: max_phase_lb, Length: 5266, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert both X &amp; y to arrays</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.to_numpy()</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using train_test_split() this time to split data</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, stratify<span class="op">=</span>y, random_state<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After data splitting, a RF classifier was trained with reference to this <a href="https://github.com/rinikerlab/GHOST/blob/main/notebooks/example_GHOST.ipynb">notebook</a>.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># max_features = "sqrt" by default</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> RandomForestClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>, max_features<span class="op">=</span><span class="st">"sqrt"</span>, oob_score<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>rfc.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=3, oob_score=True, random_state=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(max_depth=3, oob_score=True, random_state=1)</pre></div></div></div></div></div>
</div>
</div>
<ol start="4" type="1">
<li>Extracted positive prediction probabilities for the testing set and showed confusion matrix with classification metrics</li>
</ol>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>test_probs <span class="op">=</span> rfc.predict_proba(X_test)[:, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some reference links and explanations for area under the ROC curve and Cohen’s Kappa.</p>
<p><strong>Area under the ROC curve</strong>: <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#receiver-operating-characteristic-roc">reference</a> - the area under a curve plot between <em>sensitivity</em> or <em>recall</em> (percent of all 1s classified correctly by a classifier or true positive rate) and <em>specificity</em> (percent of all 0s classified correctly by a classifier, or equivalent to 1 - false positive rate or true negative rate) <span class="citation" data-cites="bruce2020">(<a href="#ref-bruce2020" role="doc-biblioref">Bruce, Bruce, and Gedeck 2020</a>)</span>. It is useful for evaluating the performance of a classification model via comparing the true positive rate and false positive rate which are influenced by shifting the decision threshold. Area under the ROC is usually represented as a number ranging from 0 to 1 (1 being a perfect classifier, 0.5 or below meaning a poor, ineffective classifier)</p>
<p><strong>Cohen’s Kappa score</strong>: <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#cohen-s-kappa">reference</a> - a score that is used to measure the agreement of labelling between two annotators (usually between -1 and 1, the higher the score the better the agreement)</p>
<p>Rather than re-inventing the wheel, the following function code for calculating metrics of the RF model were adapted from <a href="https://github.com/rinikerlab/GHOST/blob/main/notebooks/example_GHOST.ipynb">this notebook</a>, from <a href="https://github.com/rinikerlab/GHOST">GHOST repository</a>. I have only added some comments for clarities, and also added a zero_division parameter for the classification_report to mute the warning message when the results ended up being 0 due to divisions by zero.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_metrics(y_test, test_probs, threshold <span class="op">=</span> <span class="fl">0.5</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Target label assigned according to stated decision threshold (default = 0.5)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e.g. second annotator (expected label)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> [<span class="dv">1</span> <span class="cf">if</span> x<span class="op">&gt;=</span>threshold <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> x <span class="kw">in</span> test_probs]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate area under the ROC curve based on prediction score</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    auc <span class="op">=</span> metrics.roc_auc_score(y_test, test_probs)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Cohen's Kappa score</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e.g. y_test as first annotator (predicted label)</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    kappa <span class="op">=</span> metrics.cohen_kappa_score(y_test, scores)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Formulate the confusion matrix</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    confusion <span class="op">=</span> metrics.confusion_matrix(y_test, scores, labels <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(y_test)))</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'thresh: </span><span class="sc">%.2f</span><span class="st">, kappa: </span><span class="sc">%.3f</span><span class="st">, AUC test-set: </span><span class="sc">%.3f</span><span class="st">'</span><span class="op">%</span>(threshold, kappa, auc))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics.classification_report(y_test, scores, zero_division<span class="op">=</span><span class="fl">0.0</span>))</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: roc_auc_score measures true positive and false positive rates, requiring binary labels (e.g.&nbsp;0s and 1s) in the data</p>
<p>Then showed confusion matrix along with area under the ROC curve and Cohen’s Kappa.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>calc_metrics(y_test, test_probs, threshold <span class="op">=</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>thresh: 0.50, kappa: 0.000, AUC test-set: 0.536
[[1052    0]
 [   2    0]]
              precision    recall  f1-score   support

         0.0       1.00      1.00      1.00      1052
         1.0       0.00      0.00      0.00         2

    accuracy                           1.00      1054
   macro avg       0.50      0.50      0.50      1054
weighted avg       1.00      1.00      1.00      1054
</code></pre>
</div>
</div>
<p>To help with interpreting the confusion matrix, <em>scikit-learn</em> actually had a handy plotting code to visualise the matrix.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ConfusionMatrixDisplay.from_estimator(rfc, X_test, y_test)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2_random_forest_classifier_files/figure-html/cell-33-output-1.png" width="525" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It was very obvious that not all of the compounds were classified in the testing set. There were only 1052 compounds classified as true negative, and none in the testing set were labelled as true positive. The likely reason was due to the very imbalanced ratio of actives (only 10 max phase 4 which were labelled as “1” compounds) and inactives (5256 max phase 0 compounds). Besides the imbalanced dataset, the decision threshold was also normally set at 0.5, meaning the classifier was likely going to lose the chance to classify the true positive compounds due to the very skewed ratio of actives to inactives.</p>
<ol start="5" type="1">
<li><p>Two approaches were used in the GHOST (generalized threshold shifting) paper:</p>
<ul>
<li><p>Approach 1 (out-of-bag method, more computer efficient, aimed for RF classifiers) based on <a href="http://rdkit.blogspot.com/2018/11/working-with-unbalanced-data-part-i.html">RDKit blog post</a> or its <a href="https://nbviewer.org/github/greglandrum/rdkit_blog/blob/master/notebooks/Working%20with%20unbalanced%20data%20part%201.ipynb">viewable notebook version</a> via nbviewer</p></li>
<li><p>Approach 2 led to <a href="https://github.com/rinikerlab/GHOST">GHOST</a> procedure with a goal to optimise and shift the decision threshold in any classification methods to catch the minor portion of actives (rather than the major portion of inactives)</p></li>
<li><p>note: both approaches were shown to be performing similarly in the paper</p></li>
</ul></li>
</ol>
<p>I only used approach 2 here since the RDKit blog post had already explained approach 1 in depth.</p>
<p>The next step involved extracting prediction probabilities from the RF classifier trained model.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the positive prediction probabilities of the training set</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>train_probs <span class="op">=</span> rfc.predict_proba(X_train)[:, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Used GHOST strategy in a postprocessing way (note: last post used data re-sampling method in a preprocessing way)</li>
</ol>
<p>The decision threshold were optimised by using <em>ghostml</em> code via testing various different thresholds, e.g.&nbsp;in spaces of 0.05 that ranged from 0.05 to 0.5. The most optimal threshold would have the most maximised Cohen’s kappa.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up different decision thresholds</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>thresholds <span class="op">=</span> np.<span class="bu">round</span>(np.arange(<span class="fl">0.05</span>,<span class="fl">0.55</span>,<span class="fl">0.05</span>), <span class="dv">2</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>thresholds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>array([0.05, 0.1 , 0.15, 0.2 , 0.25, 0.3 , 0.35, 0.4 , 0.45, 0.5 ])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking for the best threshold with the most optimal Cohen's Kappa</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>new_threshold <span class="op">=</span> ghostml.optimize_threshold_from_predictions(y_train, train_probs, thresholds, ThOpt_metrics <span class="op">=</span> <span class="st">'ROC'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the calc_metrics function again on the newly-found or shifted decision threshold.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>calc_metrics(y_train, train_probs, threshold <span class="op">=</span> new_threshold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>thresh: 0.10, kappa: 0.933, AUC test-set: 1.000
[[4204    0]
 [   1    7]]
              precision    recall  f1-score   support

         0.0       1.00      1.00      1.00      4204
         1.0       1.00      0.88      0.93         8

    accuracy                           1.00      4212
   macro avg       1.00      0.94      0.97      4212
weighted avg       1.00      1.00      1.00      4212
</code></pre>
</div>
</div>
<p>Here, after shifting the decision threshold with the most optimal Cohen’s Kappa score, we could see an improved number of compounds labelled within the true negative class (increasing from 1052 to 4204), and more importantly, we could see the true positive class improved from 0 to 7 as well.</p>
<p><br></p>
</section>
<section id="plotting-roc-curves" class="level5">
<h5 class="anchored" data-anchor-id="plotting-roc-curves"><strong>Plotting ROC curves</strong></h5>
<p>Time for some plots - I’ve shown two different ways to plot ROC curves below.</p>
<ol type="1">
<li>Using <em>scikit-learn</em></li>
</ol>
<p>Testing set ROC curve - obviously, this was not a good classifier with a poor AUC.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_predictions(y_test, test_probs, plot_chance_level <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x12ce82710&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2_random_forest_classifier_files/figure-html/cell-38-output-2.png" width="589" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Training set ROC curve - this probably looked too good to be true or a textbook-standard ROC curve with AUC at 1.0.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_predictions(y_train, train_probs, plot_chance_level <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x12cece890&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2_random_forest_classifier_files/figure-html/cell-39-output-2.png" width="589" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Alternative method using matplotlib which reproduced a similar training set ROC plot:</li>
</ol>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking for true positive rate (tpr), false positive rate (fpr) &amp; threshold</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresh <span class="op">=</span> metrics.roc_curve(y_train, train_probs)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lw = linewidth</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, lw <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># show random guessing line (threshold = 0.5)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color <span class="op">=</span> <span class="st">"g"</span>, lw <span class="op">=</span> <span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>])</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">1.0</span>])</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"specificity"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"recall"</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2_random_forest_classifier_files/figure-html/cell-40-output-1.png" width="599" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="downsides-and-thoughts" class="level5">
<h5 class="anchored" data-anchor-id="downsides-and-thoughts"><strong>Downsides and thoughts</strong></h5>
<p>I wanted to mention that the testing set used here was most likely not the best ones to be used. There could be many overlaps or similarities between the training and testing sets, since they all came from ChEMBL database. For demonstration and learning purposes, I ended up using similar dataset as last time. Hopefully, I can try other open-source or public drug discovery datasets in the near future.</p>
<p>The other thing to mention was that I should try different molecular fingerprints or descriptors as well, rather than only using RDKit2D, which might lead to different results. I should also probably slowly move onto using multiple datasets or targets in a project, which would likely make things more interesting. On the other hand, I also wanted to avoid this in order to make the topic of interest as clear and simple as possible for me or anyone who’s trying to learn.</p>
<p><br></p>
</section>
<section id="acknowledgements" class="level5">
<h5 class="anchored" data-anchor-id="acknowledgements"><strong>Acknowledgements</strong></h5>
<p>I’d like to thank Riniker lab again for the GHOST paper, along with all the authors, contributors or developers for all of the software packages mentioned in this post, and also, huge thanks should also go to the authors of the reference notebooks mentioned in the post as well.</p>


</section>
</div>

</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bruce2020" class="csl-entry" role="listitem">
Bruce, Peter, Andrew Bruce, and Peter Gedeck. 2020. <em>Practical Statistics for Data Scientists</em>. <a href="https://www.oreilly.com/library/view/practical-statistics-for/9781492072935/">https://www.oreilly.com/library/view/practical-statistics-for/9781492072935/</a>.
</div>
<div id="ref-esposito2021" class="csl-entry" role="listitem">
Esposito, Carmen, Gregory A. Landrum, Nadine Schneider, Nikolaus Stiefl, and Sereina Riniker. 2021. <span>“GHOST: Adjusting the Decision Threshold to Handle Imbalanced Data in Machine Learning.”</span> <em>Journal of Chemical Information and Modeling</em> 61 (6): 2623–40. <a href="https://doi.org/10.1021/acs.jcim.1c00160">https://doi.org/10.1021/acs.jcim.1c00160</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>h/t: Greg Landrum for his comment on Mastodon for the last RF post (which led to this follow-up post)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/jhylin\.github\.io\/Data_in_life_blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "jhylin/Data_in_life_blog";
    script.dataset.repoId = "R_kgDOHw7lGQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOHw7lGc4CQzQ_";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Website made with 💜 in <a href="https://quarto.org/">Quarto</a> by Jennifer HY Lin © 2022 - 2025</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jhylin/Data_in_life_blog/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>